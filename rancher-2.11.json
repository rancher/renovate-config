{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": ["{{#if env.RENOVATE_EXTENDS_PRESET}}{{env.RENOVATE_EXTENDS_PRESET}}{{else}}github>rancher/renovate-config#release{{/if}}"],
  "vulnerabilityAlerts": { "enabled": true },
  "osvVulnerabilityAlerts": true,
  "packageRules": [
    {
      "matchUpdateTypes": ["major","minor","patch","pin","digest","pinDigest"],
      "enabled": false
    },
    {
      "description": "Enable updates for packages with known vulnerabilities",
      "matchJsonata": ["$exists(vulnerabilityFixVersion)"],
      "enabled": true
    },
    {
      "description": "Enable patch updates for Go packages",
      "matchPackageNames": [
        "golang",
        "go",
        "registry.suse.com/bci/golang",
        "registry.opensuse.org/opensuse/bci/golang"
      ],
      "matchUpdateTypes": ["patch"],
      "enabled": true
    },
    {
      "description": "Restrict Go versions to below 1.25.0",
      "matchPackageNames": [
        "golang",
        "go",
        "registry.suse.com/bci/golang",
        "registry.opensuse.org/opensuse/bci/golang"
      ],
      "allowedVersions": "<1.25.0"
    },
    {
      "description": "Enable patch updates for golang-version datasource",
      "matchDatasources": ["golang-version"],
      "matchUpdateTypes": ["patch"],
      "enabled": true
    },
    {
      "description": "Restrict golang-version to below 1.25.0",
      "matchDatasources": ["golang-version"],
      "allowedVersions": "<1.25.0"
    },
    {
      "description": "Enable patch updates for kubectl/k8s packages",
      "matchManagers": ["gomod", "custom.regex", "dockerfile"],
      "matchPackageNames": [
        "rancher/kubectl",
        "kubernetes/kubernetes",
        "k8s.io/kubernetes"
      ],
      "matchUpdateTypes": ["patch"],
      "enabled": true
    },
    {
      "description": "Restrict kubectl/k8s versions to below 1.33.0",
      "matchManagers": ["gomod", "custom.regex", "dockerfile"],
      "matchPackageNames": [
        "rancher/kubectl",
        "kubernetes/kubernetes",
        "k8s.io/kubernetes"
      ],
      "allowedVersions": "<1.33.0"
    },
    {
      "description": "Enable patch updates for k8s.io dependencies",
      "matchManagers": ["gomod"],
      "matchPackageNames": [
        "!k8s.io/kubernetes",
        "k8s.io/**"
      ],
      "matchUpdateTypes": ["patch"],
      "enabled": true,
      "semanticCommitType": "chore",
      "semanticCommitScope": "deps",
      "commitMessageAction": "update",
      "commitMessageTopic": "k8s dependencies",
      "commitMessageExtra": "to {{#if newValue}}{{newValue}}{{else}}new patch version{{/if}}"
    },
    {
      "description": "Restrict k8s.io dependencies to below 0.33.0",
      "matchManagers": ["gomod"],
      "matchPackageNames": [
        "!k8s.io/kubernetes",
        "k8s.io/**"
      ],
      "allowedVersions": "<0.33.0"
    },
    {
      "description": "Disable major bumps",
      "matchPackageNames": ["rancher/kuberlr-kubectl"],
      "matchUpdateTypes": ["minor","patch"],
      "enabled": true
    },
    {
      "description": "Disable vulnerability alerts for all k8s and golang modules to prevent non-patch level bumps",
      "matchPackageNames": [
        "golang",
        "go",
        "registry.suse.com/bci/golang",
        "registry.opensuse.org/opensuse/bci/golang",
        "rancher/kubectl",
        "kubernetes/kubernetes",
        "k8s.io/**"
      ],
      "vulnerabilityAlerts": { "enabled": false }
    }
  ]
}
